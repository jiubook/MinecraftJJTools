<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>J2MM 转换器</title>
  <link rel="stylesheet" href="./J2MM.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-exchange-alt"></i> JSON 转 MCBBS(BBCode)/Markdown 转换器 (增强版)</h1>
      <p>上传文章 JSON（包含 <span class="highlight">blocks</span> 数组），支持逐block翻译校对与自定义模块输出</p>
    </header>

    <div class="main-content">
      <!-- 上传区域 -->
      <div class="section upload-section" id="uploadSection">
        <div class="upload-area">
          <i class="fas fa-cloud-upload-alt"></i>
          <P>上传 JSON 文件</p>
          <p>点击下方按钮选择 JSON 文件，或拖放文件到此处</p>
          <input type="file" id="fileInput" class="file-input" accept=".json,application/json">
          <button class="btn" id="selectFileBtn">
            <i class="fas fa-file-upload"></i> 选择 JSON 文件
          </button>
          <button class="btn secondary" id="demoBtn">
            <i class="fas fa-magic"></i> 使用示例
          </button>
        </div>
      </div>

      <!-- 翻译校对区域 -->
      <div class="section" id="translationSection" style="display: none;">
        <h3><i class="fas fa-language"></i> 逐block翻译校对</h3>
        <p style="color: #666; margin-bottom: 10px; font-size: 0.9rem;">提示：点击block可展开编辑，支持修改 p/blockquote/h2/ul 等类型内容</p>
        <div class="translation-panel" id="translationPanel"></div>
        <div style="text-align: center; margin-top: 10px;">
          <button class="btn" id="regenerateBtn"><i class="fas fa-sync-alt"></i> 重新生成输出</button>
          <button class="btn secondary" id="resetEditsBtn"><i class="fas fa-undo"></i> 重置编辑</button>
        </div>
      </div>

      <!-- 模块管理区域 -->
      <div class="section">
        <h3><i class="fas fa-cogs"></i> 模块管理</h3>
        <div class="module-manager">
          <div class="module-col">
            <h4>默认模块</h4>
            <div id="defaultModulesContainer"></div>
          </div>

          <div class="module-col">
            <h4>自定义模块</h4>
            <div id="customModulesContainer"></div>
            <div style="margin-top: 10px;">
              <button class="btn small" id="addCustomModuleBtn"><i class="fas fa-plus"></i> 添加自定义模块</button>
              <button class="btn small secondary" id="saveCustomModulesBtn"><i class="fas fa-save"></i> 保存模块配置</button>
              <button class="btn small secondary" id="loadCustomModulesBtn"><i class="fas fa-upload"></i> 加载模块配置</button>
            </div>
            <p style="margin-top:10px;color:#666;font-size:.9rem;">
              模块内容可直接写 <b>BBCode</b> 或 <b>Markdown</b>，输出会自动转换为对应格式。
            </p>
          </div>
        </div>
      </div>

      <!-- 输出区域 -->
      <div class="section output-section" id="outputSection" style="display: none;">
        <div class="output-box">
          <div class="box-header">
            <span>BBCode 输出（MCBBS 风格）</span>
            <div class="header-actions">
              <button class="copy-btn" id="copyBBCodeBtn" title="复制 BBCode 到剪贴板">复制</button>
              <i class="fas fa-code icon"></i>
            </div>
          </div>
          <div class="box-content">
            <textarea id="bbcodeOutput" placeholder="上传 JSON 后，BBCode 将显示在这里..."></textarea>
          </div>
        </div>

        <div class="output-box">
          <div class="box-header">
            <span>Markdown 输出</span>
            <div class="header-actions">
              <button class="copy-btn" id="copyMarkdownBtn" title="复制 Markdown 到剪贴板">复制</button>
              <i class="fas fa-hashtag icon"></i>
            </div>
          </div>
          <div class="box-content">
            <textarea id="markdownOutput" placeholder="上传 JSON 后，Markdown 将显示在这里..."></textarea>
          </div>
        </div>

        <div class="output-box full">
          <div class="box-header">
            <span>实时预览（BBCode 近似渲染）</span>
            <i class="fas fa-eye icon"></i>
          </div>
          <div class="box-content">
            <div id="previewArea" class="preview-content">
              <p style="text-align: center; color: #6c757d; padding: 40px 0;">上传 JSON 文件后，预览效果将显示在这里...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 示例区域 -->
      <div class="section example-section">
        <h3><i class="fas fa-info-circle"></i> 示例 JSON 结构（关键字段）</h3>
        <p>转换器将优先使用 <span class="highlight">blocks</span>。每个 block 推荐同时提供 source_text 与 translated_text：</p>
        <div class="example-json" style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 6px; font-family: 'Consolas', monospace; font-size: 0.9rem; overflow: auto; max-height: 240px;">
<pre>{
  "title": "Another step towards Vibrant Visuals",
  "translated_title": "迈向 Vibrant Visuals 的又一步",
  "release_date": "2026-02-18T15:00:34Z",
  "url": "https://...",
  "author": "Staff",
  "description": "We’re still hard at work...",
  "blocks": [
    {"id":"b0001","type":"p","source_text":"We’re still hard at work...","translated_text":"我们仍在努力..."},
    {"id":"b0003","type":"h2","source_text":"What are we changing?","translated_text":"我们要改变什么？"}
  ]
}</pre>
        </div>
      </div>
    </div>

    <div class="status-bar">
      <span id="statusText">准备就绪 - 等待文件上传</span>
    </div>

    <div class="footer">
      <p>提示：本工具只做格式转换，不会上传文件到服务器（纯前端本地处理）。所有编辑仅在本地生效。</p>
      <a href="https://www.gnu.org/licenses/gpl-3.0.zh-cn.html" target="_blank" rel="noopener">本Ai工具以 GPL-3.0 协议发布</a> | <a href="https://github.com/jiubook/MinecraftJJTools" target="_blank" rel="noopener">J2MM、JBAiGNN</a>
    </div>
  </div>
<script src="./J2MM.js"></script>
</body>
</html>
